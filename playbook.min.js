(function(l,q){"object"===typeof exports?q(Raphael,exports):"function"===typeof define&&define.amd?define(["raphael","exports"],q):q(Raphael,l)})(this,function(l,q){function p(a){a=a||{};this.options={};this.options.element=a.element||"canvas";this.options.gridSize=a.gridSize||25;this.options.fieldWidth=a.fieldWidth||1200;this.options.fieldHeight=a.fieldHeight||900;this.options.yardLineGap=a.yardLineGap||100;this.options.yardLineWidth=this.options.fieldWidth;this.options.yardLineHeight=a.yardLineHeight||
8;this.options.yardMarkerWidth=a.yardMarkerWidth||50;this.options.routeWidth=a.routeWidth||20;this.options.LOS=this.options.fieldHeight-3*this.options.yardLineGap;this.options.colors=a.colors||{offense:"#e33232",defense:"#323ae3"};this.options.routeOpacity=a.routeOpacity||{offense:1,defense:0.75};this.mode=a.mode||"move"}function r(a,e,c,b,d,f){a=a.paper.circle(e,c,18).attr("fill",b).attr("stroke-width",4).attr("stroke-fill","black").data("side",d).draggable();f&&a.data("route",f);return a}function s(a,
e,c,b,d){a=a.paper.path(e).attr("stroke",c).attr("stroke-width",a.options.routeWidth).attr("stroke-opacity",a.options.routeOpacity[b]?a.options.routeOpacity[b]:1);d&&"rect"==d.type&&a.data("zone",d);a.removeAll=function(){var a=this.data("zone");a&&"rect"==a.type&&a.remove();this.remove()};a.pathdrag();a.data("side",b);return a}function t(a,e,c,b,d,f){return a.paper.rect(e,c,b,d,20).attr("fill",a.options.colors.defense).attr("stroke-width",0).attr("fill-opacity",a.options.routeOpacity[f]?a.options.routeOpacity[f]:
1)}function u(a,e){a.el.draggable=function(){var a,b,d,f,k;d=this;d.type&&"circle"==d.type?(f="cx",k="cy"):(f="x",k="y");this.drag(function(g,h,n,m){g=a+g;h=b+h;"move"==e.mode&&(d.attr(f,g).attr(k,h),(n=d.data("route"))&&(n.type&&"path"==n.type)&&n.movePathStart(g,h));"design"==e.mode&&d.pathFirstSegment(g,h)},function(g,h){a=d.attr(f);b=d.attr(k);"design"==e.mode&&d.createRoute(g,h)},function(a){"move"==e.mode&&d.snapToGrid(a)});return this}}function v(a,e){a.el.snapToGrid=function(c){var b;this.type&&
"circle"==this.type?(c="cx",b="cy"):(c="x",b="y");var d=this.attr(c),f=this.attr(b),d=a.snapTo(e.options.gridSize,d,10),f=a.snapTo(e.options.gridSize,f,10),k={};k[c]=d;k[b]=f;this.animate(k,100);(c=this.data("route"))&&(c.type&&"path"==c.type)&&c.movePathStart(d,f);return this}}function w(a,e){a.el.pathdrag=function(){var a,b,d,f;this.drag(function(k,g,h,n){var m=this.attr("path");("offense"==b||"move"==e.mode)&&(a&&0<a)&&(m[a]=["L",d+k,f+g],this.attr("path",m));"defense"==b&&(h=this.data("zone"))&&
"rect"==h.type&&(k=0<k?k:-1*k,g=0<g?g:-1*g,n=m[m.length-1][1],m=m[m.length-1][2],h.attr("height",g),h.attr("width",k),h.attr("x",n-k/2),h.attr("y",m-g/1.1))},function(k,g){d=k;f=g;var h=this.attr("path");b=this.data("side");"offense"==b&&"design"==e.mode&&(a=h.length);if("move"==e.mode){a=h.length-1;for(var n=1E4,m=1;m<h.length;m++)if(3==h[m].length){var l=k-h[m][1],p=g-h[m][2],l=0>l?-1*l:l,p=0>p?-1*p:p,l=l+p;l<=n&&(n=l,a=m)}}"defense"==b&&"design"==e.mode&&((n=this.data("zone"))&&"rect"==n.type&&
n.remove(),this.data("zone",t(e,h[h.length-1][1],h[h.length-1][2],0,0,b)))});return this}}function x(a,e){a.el.createRoute=function(a,b){var d=this.data("route"),f=this.data("side");d&&(d.type&&"path"==d.type)&&d.removeAll();var k,g,d=this.attr("fill");this.type&&"circle"==this.type?(k="cx",g="cy"):(k="x",g="y");k=this.attr(k);g=this.attr(g);f=s(e,"M"+k+","+g,d,f);this.data("route",f);e.playersToFront();return this}}function y(a){a.el.pathFirstSegment=function(a,c){var b=this.data("route");if(b){var d=
b.attr("path").slice(0,1);d.push(["L",a,c]);b.attr("path",d)}return this}}function z(a){a.el.movePathStart=function(a,c){if(this&&"path"==this.type){var b=this.attr("path");b&&(b=b.slice(1),b.unshift(["M",a,c]),this.attr("path",b))}return this}}function A(a){return new p(a)}p.prototype.build=function(){u(l,this);v(l,this);x(l,this);w(l,this);y(l);z(l);this.paper=l(this.options.element,this.options.fieldWidth,this.options.fieldHeight);for(var a=this.paper.set(),e=0;e<=this.options.fieldWidth;e+=this.options.yardLineGap){var c=
"#3a8c3a";e/this.options.yardLineGap%2&&(c="#306f30");a.push(this.paper.rect(0,e,this.options.fieldWidth,this.options.yardLineGap).attr("fill",c).attr("stroke-width",0))}for(var c=this.paper.set(),b=this.paper.set(),d=this.paper.set(),e=0;e<this.options.fieldHeight;e+=this.options.yardLineGap)b.push(this.paper.rect(0,e-this.options.yardLineHeight/2,this.options.yardLineWidth,this.options.yardLineHeight).attr("fill","#f0fff0").attr("stroke-width",0));for(e=0;e<this.options.fieldHeight;e+=20)d.push(this.paper.rect(20,
e,this.options.yardMarkerWidth,this.options.yardLineHeight/2).attr("fill","#f0fff0").attr("stroke-width",0),this.paper.rect(this.options.fieldWidth-(this.options.yardMarkerWidth+20),e,this.options.yardMarkerWidth,this.options.yardLineHeight/2).attr("fill","#f0fff0").attr("stroke-width",0));c.push(b);c.push(d);this.field=this.paper.set();this.field.push(a,c);this.players=this.paper.set();for(a=0;22>a;a++)10<a?(e=this.options.colors.defense,c=100*(a-10),b=this.options.LOS-25,d="defense"):(e=this.options.colors.offense,
c=100*(a+1),b=this.options.LOS+25,d="offense"),this.players.push(r(this,c,b,e,d));return this};p.prototype.exportPlay=function(){var a,e,c,b,d,f,k,g={offense:[],defense:[]};this.players.forEach(function(h){a=h.attr("cx");e=h.attr("cy");(d=h.data("route"))&&d.type&&"path"==d.type?(c=d.attr("path"),(f=d.data("zone"))&&f.type&&"rect"==f.type?(b={},b.x=f.attr("x"),b.y=f.attr("y"),b.width=f.attr("width"),b.height=f.attr("height")):b=""):b=c="";k=h.data("side");g[k].push({cx:a,cy:e,side:k,route:c,zone:b})});
return g};p.prototype.importPlay=function(a){if(a&&(a.offense||a.defense)){var e=function(c,b){if(0<a[c].length){var d=[];b.players.forEach(function(a){if(a.data("side")==c){d.push(a);var b=a.data("route");b&&(b.type&&"path"==b.type)&&b.removeAll();a.remove();a.removeData()}});for(var f=0;f<d.length;f++)b.players.exclude(d[f]);for(f=0;f<a[c].length;f++)if(a[c][f]&&a[c][f].cx&a[c][f].cy&&c){var e=b.options.colors[c],g=a[c][f].zone?t(b,a[c][f].zone.x,a[c][f].zone.y,a[c][f].zone.width,a[c][f].zone.height,
c):{},g=a[c][f].route?s(b,a[c][f].route,e,c,g):{};b.players.push(r(b,a[c][f].cx,a[c][f].cy,e,c,g))}}};0<a.offense.length&&e("offense",this);0<a.offense.length&&e("defense",this)}};p.prototype.playersToFront=function(){this.players.forEach(function(a){a.toFront()});return this};p.prototype.changeMode=function(a){this.mode=a;return this};return q.playbook=A});
